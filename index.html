
<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</title>
  <style>
    body {
      font-family: 'Sarabun', sans-serif;
      background-color: #f0fff0;
      color: #333;
      margin: 0;
      padding: 20px;
    }
    h1 {
      font-size: 24px;
      font-weight: bold;
      color: #2e7d32;
    }
    label, select, input, button {
      font-size: 16px;
      margin: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #a5d6a7;
    }
    button {
      padding: 10px 20px;
      background-color: #66bb6a;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    button:hover {
      background-color: #4caf50;
    }
  </style>
</head>
<body>
  <h1>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ä‡πá‡∏Ñ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</h1>
  <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: <input type="date" id="datePicker"></label>
  <label>‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô:
    <select id="classSelect">
      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô --</option>
      <option value="‡∏õ.1">‡∏õ.1</option>
      <option value="‡∏õ.2">‡∏õ.2</option>
      <option value="‡∏õ.3">‡∏õ.3</option>
    </select>
  </label>
  <label>‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤:
    <select id="subjectSelect">
      <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤ --</option>
      <option value="‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå">‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå</option>
      <option value="‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢">‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</option>
      <option value="‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©">‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©</option>
    </select>
  </label>
  <br/>
  <button onclick="loadStudents()">‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠</button>
  <button onclick="submitAttendance()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
  <button onclick="loadAttendance()">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</button>
  <table>
    <thead>
      <tr>
        <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>
        <th>‡∏ä‡∏∑‡πà‡∏≠</th>
        <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
      </tr>
    </thead>
    <tbody id="studentsTableBody"></tbody>
  </table>

  <script>
    const scriptURL = "https://script.google.com/macros/s/AKfycbwn2FxQP0svSGGUrIRR6Y841F4ZV1MkUOImL6mpcrn6FyfTSKqWOCwJ2-hP6kk8q-U/exec";

    async function loadStudents() {
      const className = document.getElementById("classSelect").value;
      if (!className) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡∏±‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");

      const res = await fetch(`${scriptURL}?action=getStudents&class=${encodeURIComponent(className)}`);
      const data = await res.json();
      if (data.status !== "success") return alert("‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏î‡πâ");

      const tbody = document.getElementById("studentsTableBody");
      tbody.innerHTML = "";
      data.students.forEach((student, index) => {
        const row = `<tr>
          <td>${student.no}</td>
          <td>${student.name}</td>
          <td>
            <select data-no="${student.no}" data-name="${student.name}">
              <option value="‡∏°‡∏≤">‚úÖ ‡∏°‡∏≤</option>
              <option value="‡∏™‡∏≤‡∏¢">üïí ‡∏™‡∏≤‡∏¢</option>
              <option value="‡∏•‡∏≤">üìù ‡∏•‡∏≤</option>
              <option value="‡∏Ç‡∏≤‡∏î">‚ùå ‡∏Ç‡∏≤‡∏î</option>
            </select>
          </td>
        </tr>`;
        tbody.insertAdjacentHTML("beforeend", row);
      });
    }

    async function submitAttendance() {
      const date = document.getElementById("datePicker").value;
      const className = document.getElementById("classSelect").value;
      const subject = document.getElementById("subjectSelect").value;
      if (!date || !className || !subject) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö");

      const rows = document.querySelectorAll("#studentsTableBody select");
      const data = Array.from(rows).map(select => ({
        no: select.dataset.no,
        name: select.dataset.name,
        status: select.value
      }));

      const payload = {
        date, class: className, subject, data
      };

      const res = await fetch(scriptURL, {
        method: "POST",
        body: JSON.stringify(payload)
      });

      const result = await res.json();
      alert(result.message || "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢");
    }

    async function loadAttendance() {
      const date = document.getElementById("datePicker").value;
      const className = document.getElementById("classSelect").value;
      const subject = document.getElementById("subjectSelect").value;
      if (!date || !className || !subject) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà ‡∏ä‡∏±‡πâ‡∏ô ‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ä‡∏≤");

      const res = await fetch(`${scriptURL}?action=getAttendance&date=${encodeURIComponent(date)}&class=${encodeURIComponent(className)}&subject=${encodeURIComponent(subject)}`);
      const data = await res.json();
      if (data.status !== "success") return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");

      const tbody = document.getElementById("studentsTableBody");
      tbody.innerHTML = "";
      data.attendance.forEach(student => {
        const row = `<tr>
          <td>${student.no}</td>
          <td>${student.name}</td>
          <td>
            <select data-no="${student.no}" data-name="${student.name}">
              <option value="‡∏°‡∏≤" ${student.status === "‡∏°‡∏≤" ? "selected" : ""}>‚úÖ ‡∏°‡∏≤</option>
              <option value="‡∏™‡∏≤‡∏¢" ${student.status === "‡∏™‡∏≤‡∏¢" ? "selected" : ""}>üïí ‡∏™‡∏≤‡∏¢</option>
              <option value="‡∏•‡∏≤" ${student.status === "‡∏•‡∏≤" ? "selected" : ""}>üìù ‡∏•‡∏≤</option>
              <option value="‡∏Ç‡∏≤‡∏î" ${student.status === "‡∏Ç‡∏≤‡∏î" ? "selected" : ""}>‚ùå ‡∏Ç‡∏≤‡∏î</option>
            </select>
          </td>
        </tr>`;
        tbody.insertAdjacentHTML("beforeend", row);
      });
    }
  </script>
</body>
</html>
